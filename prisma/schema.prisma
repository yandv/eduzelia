// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model Professor {
  id String @id @default(cuid())

  nome String

  turmas Turma[]
  aulas  Aula[]

  @@map("professor")
}

model Aluno {
  id String @id @default(cuid())

  nome String

  AlunoTurma AlunoTurma[]

  @@map("aluno")
}

model AlunoTurma {
  id String @id @default(cuid())

  alunoId String
  turmaId String

  notas       Nota[]
  frequencias Frequencia[]

  aluno Aluno @relation(fields: [alunoId], references: [id])
  turma Turma @relation(fields: [turmaId], references: [id])

  @@unique([alunoId, turmaId])
  @@map("aluno_turma")
}

model Turma {
  id String @id @default(cuid())

  nome        String
  ano         Int
  professorId String
  professor   Professor @relation(fields: [professorId], references: [id])

  aulas      Aula[]
  AlunoTurma AlunoTurma[]

  @@unique([nome, ano])
  @@map("turma")
}

model Aula {
  id String @id @default(cuid())

  data        DateTime @unique
  descricao   String   @db.VarChar(2048)
  turmaId     String
  professorId String

  turma       Turma        @relation(fields: [turmaId], references: [id])
  professor   Professor    @relation(fields: [professorId], references: [id])
  frequencias Frequencia[]

  @@unique([data, turmaId, professorId])
  @@map("aula")
}

model Nota {
  id String @id @default(cuid())

  valor Float
  index Int

  alunoTurmaId String

  AlunoTurma   AlunoTurma @relation(fields: [alunoTurmaId], references: [id])

  @@map("nota")
  @@unique([index, alunoTurmaId])
}

model Frequencia {
  id String @id @default(cuid())

  presente Boolean

  aulaId  String
  alunoTurmaId String

  AlunoTurma   AlunoTurma @relation(fields: [alunoTurmaId], references: [id])
  Aula         Aula        @relation(fields: [aulaId], references: [id])

  @@map("frequencia")
}
